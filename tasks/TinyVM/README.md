TinyVM
======
> Добро пожаловать в виртуальность! Для продолжения введите ваш пароль.

Flag
----
QCTF_f34d657f05e0ac1b279868002cf79b36

Описание
--------
Участнику дана программа, которая проверяет на корректность введённый пароль.
Программа представляет собой интерпретатор примитивных команд, каждая из которых преобразует некоторым обратимым образом один из символов пароля. Набор команд хранится в виде текстовой строки. После их интерпретации, результат преобразования пароля сравнивается с массивом констант.

Файлы
-----
1. **user/vm.exe** - исполняемый файл
2. **vm.c** - исходный код
3. **vm_gen.py** - генератор случайной строки команд и результирующего массива для данного флага
4. **solve.py** - пример программы для восстановления флага

WriteUp
-------
1. Посмотрим, как работает выданная программа: запрашивается пароль, после ввода произвольной строки выводится сообщение "Wrong", программа завершается.
2. Откроем файл в IDA Pro. Среди строк сразу можно заметить несколько интересных: длинная строка из цифр, букв и символов, все сообщения программы ("Welcome...", "Success...", "Wrong") и форматная строка "%37s".
3. Найдём, в каком месте программы используются эти строки. Все ссылки ведут в одну и ту же функцию, очевидно, main().
4. Проанализируем код функции: функцией puts выводится приветствие, запрашивается пароль длины не более 37 символов, а далее идут два цикла, по результатам работы которых выводится сообщение о корректности пароля.
5. Рассмотрим первый цикл: его счётчик пробегает от 0 до некоторой константы (100) с шагом 2. На каждой итерации берутся коды двух соседних символов строки s[i] и s[i+1] и из них вычитаются коды символа '0'. Далее в зависимости от s[i+1] над символом введённого пароля input[s[i]] выполняется одно из действий:
```
input[s[i]]++
input[s[i]] ^= 47
input[s[i]] -= 51
input[s[i]] *= 2
```
6. Второй цикл сравнивает полученный массив с некоторым набором байт и в зависимости от результата далее выводится соответствующее сообщение.
7. Итак, чтобы получить пароль, требуется скопировать из исполняемого файла строку команд и байты результата и обратить преобразования.
