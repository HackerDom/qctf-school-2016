Hamming
======

> TODO

Описание
--------
Участнику выдается файл с испорченным сообщением, которое предварительно было закодированно с помощью кодов Хэмминга (15, 11), а также программа, с помощью которой сообщение было получено. Необходимо декодировать сообщение. После декодирования участник видит на картинке инструкцию по получению флага: flag = 'QCTF_' + md5sum от файла с картинкой. Участник получит правильный флаг только в том случае, если верно декодирует файл с сообщением, исправив все ошибки.

Файлы
-----
1. **build.sh** - скрипт для сборки закодированного сообщения из заданной картинки
2. **flag.txt** - файл с флагом
3. **message.bin** - сообщение, полученное с помощью кодировщика *(выдается участнику)*
4. **resource**
  * **arial.ttf** - шрифт, используемый для текста на картинке
  * **test_image.jpg** - картинка, используемая в качестве образца
5. **tools**
  * **encoder**
    * **encoder** - кодировщик кодов Хэмминга *(выдается участнику)*
    * **encoder.c** - исходный код кодировщика
    * **Makefile** - файл для сборки кодировщика
  * **prepare_image.py** - скрипт, который принимает картинку и добавляет к ней текст: *Flag is concatenation of 'QCTF_' and md5sum of this image*
  * **hamming.py** - инструменты для декодирования кодов Хэмминга
  * **corrupt_image.py** - скрипт, добавляющий ошибки в сообщение
  * **check.py** - скрипт, который декодирует битое сообщение и выводит md5 от получившихся данных


Генерация флага и сообщения по заданной картинке
------------------------------------------------
Соберем кодировщик:
```
make -C ./tools/encoder/
```
Выберем какую-нибудь картинку (для примера будем использовать ./resource/test_image.jpg) и сгенерируем новую картинку формата bmp, содержащую инструкции по получению флага:
```
./tools/prepare_image.py ./resource/test_image.jpg target_image.bmp
```
Получим флаг и запомним его:
```
md5_hash=$(md5sum -b target_image.bmp | cut -f1 -d\ )
flag=QCTF_$md5_hash
echo $flag > flag.txt
```
Закодируем получившуюся картинку и добавим в сообщение ошибки. Кодировщик записывает в начало выходного файла 4 байта - размер исходного файла, после которого идет избыточный код. Для добавленя ошибок необходимо пропустить эти 4 байта от начала файла и еще некоторое количество блоков по 15 бит, чтобы не повредить заголовок bmp-файла. После этого в каждых 15 бит сообщения будем случайным образом менять один бит на противоположный:
```
./tools/encoder/encoder target_image.bmp original_message.bin
./tools/corrupt_message.py original_message.bin message.bin
```
Весь процесс сборки автоматизируется с помощью скрипта **build.sh**. Дополнительно скрипт производит проверку, что сообщение декодируется верно.

Ссылки
------
1. [Код Хэмминга](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%B4_%D0%A5%D1%8D%D0%BC%D0%BC%D0%B8%D0%BD%D0%B3%D0%B0)
